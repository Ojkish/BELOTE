<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Belote Score - Race to 1000</title>
    <style>
        :root {
            --primary: #1e293b;
            --accent1: #3b82f6; /* Bleu pour NOUS */
            --accent2: #ec4899; /* Rose/Rouge pour EUX */
            --bg: #0f172a;
            --card-bg: #ffffff;
            --goal-color: #f59e0b;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', system-ui, sans-serif; }
        body { background-color: var(--bg); color: #1e293b; padding: 10px; display: flex; justify-content: center; min-height: 100vh; }

        .app-container {
            width: 100%;
            max-width: 480px;
            background: var(--card-bg);
            border-radius: 24px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        /* --- PROGRESSION HEADERS --- */
        header {
            background: var(--primary);
            color: white;
            padding: 25px 20px;
        }

        .scores-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            text-align: center;
        }

        .team-title { font-size: 0.75rem; font-weight: 800; opacity: 0.6; letter-spacing: 2px; margin-bottom: 5px; }
        .score-val { font-size: 3.2rem; font-weight: 900; line-height: 1; margin-bottom: 10px; }

        /* Les deux barres de progression */
        .progress-container {
            height: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }
        .progress-fill {
            height: 100%;
            width: 0%;
            transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        #fill1 { background: var(--accent1); box-shadow: 0 0 10px var(--accent1); }
        #fill2 { background: var(--accent2); box-shadow: 0 0 10px var(--accent2); }

        .remaining { font-size: 0.7rem; margin-top: 8px; font-weight: 600; color: var(--goal-color); }

        /* --- DASHBOARD STATS --- */
        .diff-banner {
            background: #f1f5f9;
            padding: 8px;
            text-align: center;
            font-size: 0.85rem;
            font-weight: 700;
            border-bottom: 1px solid #e2e8f0;
        }
        #diff-text { color: #64748b; }

        /* --- INPUTS --- */
        .controls { padding: 20px; }
        .input-row { display: flex; gap: 15px; margin-bottom: 15px; }
        .input-box { flex: 1; }
        
        .capot-label { display: flex; justify-content: space-between; font-size: 0.7rem; font-weight: bold; color: #94a3b8; margin-bottom: 5px; }
        .capot-btn { cursor: pointer; color: var(--accent1); border: none; background: none; font-size: 0.7rem; font-weight: 800; }

        input[type="number"] {
            width: 100%; padding: 15px; border: 2px solid #e2e8f0; border-radius: 16px;
            font-size: 1.8rem; text-align: center; font-weight: 800; transition: 0.2s;
        }
        input[type="number"]:focus { border-color: var(--primary); outline: none; background: #f8fafc; }

        .belote-row { display: flex; justify-content: space-around; margin-bottom: 20px; }
        .belote-opt { display: flex; align-items: center; gap: 8px; font-weight: 700; cursor: pointer; color: #475569; }
        input[type="checkbox"] { width: 20px; height: 20px; accent-color: var(--primary); }

        .btn-group { display: flex; gap: 10px; padding: 0 20px 20px; }
        .btn { border: none; border-radius: 12px; font-weight: 800; cursor: pointer; transition: 0.2s; }
        .btn-main { background: var(--primary); color: white; flex: 3; padding: 18px; text-transform: uppercase; }
        .btn-undo { background: #e2e8f0; color: #475569; flex: 1; font-size: 1.5rem; }
        .btn-reset { background: none; color: #94a3b8; width: 100%; padding: 10px; font-size: 0.7rem; text-decoration: underline; }

        /* --- HISTORY --- */
        .history-list { list-style: none; max-height: 160px; overflow-y: auto; border-top: 1px solid #f1f5f9; }
        .history-item { display: flex; justify-content: space-between; padding: 12px 40px; border-bottom: 1px solid #f8fafc; font-size: 0.95rem; }
        .history-item:first-child { background: #f8fafc; font-weight: 800; color: #0f172a; }
        .history-item span { width: 30%; text-align: center; }
        .c-badge { color: #ec4899; font-weight: 900; margin-left: 4px; font-size: 0.7rem; }
    </style>
</head>
<body>

<div class="app-container">
    <header>
        <div class="scores-grid">
            <div class="team-card">
                <div class="team-title" contenteditable="true">NOUS</div>
                <div class="score-val" id="t1">0</div>
                <div class="progress-container">
                    <div id="fill1" class="progress-fill"></div>
                </div>
                <div class="remaining" id="rem1">1000 pts restants</div>
            </div>
            <div class="team-card">
                <div class="team-title" contenteditable="true">EUX</div>
                <div class="score-val" id="t2">0</div>
                <div class="progress-container">
                    <div id="fill2" class="progress-fill"></div>
                </div>
                <div class="remaining" id="rem2">1000 pts restants</div>
            </div>
        </div>
    </header>

    <div class="diff-banner" id="diff-text">Égalité au départ</div>

    <div class="controls">
        <div class="input-row">
            <div class="input-box">
                <div class="capot-label">SCORE <span class="capot-btn" onclick="setCapot(1)">CAPOT</span></div>
                <input type="number" id="s1" placeholder="0" inputmode="numeric">
            </div>
            <div class="input-box">
                <div class="capot-label">SCORE <span class="capot-btn" onclick="setCapot(2)">CAPOT</span></div>
                <input type="number" id="s2" placeholder="0" inputmode="numeric">
            </div>
        </div>
        
        <div class="belote-row">
            <label class="belote-opt"><input type="checkbox" id="b1"> Belote</label>
            <label class="belote-opt"><input type="checkbox" id="b2"> Belote</label>
        </div>
    </div>

    <div class="btn-group">
        <button class="btn btn-undo" onclick="undo()" id="undoBtn" disabled>↩</button>
        <button class="btn btn-main" onclick="addRound()">Valider la donne</button>
    </div>

    <button class="btn btn-reset" onclick="reset()">Réinitialiser le match</button>

    <ul class="history-list" id="history"></ul>
</div>

<script>
    let g1 = 0, g2 = 0, log = [];
    const GOAL = 1000, MAX = 162, CAPOT = 252;

    const in1 = document.getElementById('s1'), in2 = document.getElementById('s2');
    const chk1 = document.getElementById('b1'), chk2 = document.getElementById('b2');

    // SYNC AUTO
    function handleInput(e) {
        const source = e.target;
        const target = (source === in1) ? in2 : in1;
        const val = parseInt(source.value);
        
        if (source.value === "") target.value = "";
        else if (!isNaN(val)) {
            target.value = (val >= MAX) ? 0 : MAX - val;
        }
    }
    in1.addEventListener('input', handleInput);
    in2.addEventListener('input', handleInput);

    // AUTO SELECT & ENTER
    [in1, in2].forEach(i => {
        i.addEventListener('focus', () => setTimeout(() => i.select(), 50));
        i.addEventListener('keydown', e => { if(e.key === 'Enter') addRound(); });
    });

    function setCapot(t) {
        if(t===1) { in1.value = CAPOT; in2.value = 0; }
        else { in1.value = 0; in2.value = CAPOT; }
        in1.focus();
    }

    function addRound() {
        let v1 = parseInt(in1.value) || 0, v2 = parseInt(in2.value) || 0;
        if (in1.value === "" && in2.value === "") return;

        const isC1 = v1 >= CAPOT, isC2 = v2 >= CAPOT;
        if(chk1.checked) v1 += 20; if(chk2.checked) v2 += 20;

        log.push({v1, v2, isC1, isC2});
        g1 += v1; g2 += v2;
        
        update();
        in1.value = ""; in2.value = ""; 
        chk1.checked = false; chk2.checked = false;
        in1.focus();
    }

    function undo() {
        if (!log.length) return;
        const last = log.pop();
        g1 -= last.v1; g2 -= last.v2;
        update();
    }

    function update() {
        // Textes
        document.getElementById('t1').textContent = g1;
        document.getElementById('t2').textContent = g2;
        document.getElementById('rem1').textContent = Math.max(0, GOAL - g1) + " pts restants";
        document.getElementById('rem2').textContent = Math.max(0, GOAL - g2) + " pts restants";

        // Barres de progression (bridées à 100%)
        document.getElementById('fill1').style.width = Math.min(100, (g1/GOAL)*100) + "%";
        document.getElementById('fill2').style.width = Math.min(100, (g2/GOAL)*100) + "%";

        // Écart
        const diff = Math.abs(g1 - g2);
        const banner = document.getElementById('diff-text');
        if (g1 === g2) banner.textContent = "Égalité parfaite";
        else banner.innerHTML = `Écart : <span style="color:var(--primary)">${diff} points</span> (${g1 > g2 ? 'NOUS menons' : 'EUX mènent'})`;

        // Historique
        const hUI = document.getElementById('history');
        hUI.innerHTML = '';
        [...log].reverse().forEach(r => {
            const li = document.createElement('li');
            li.className = 'history-item';
            li.innerHTML = `<span>+${r.v1}${r.isC1?'<b class="c-badge">CAPOT</b>':''}</span><span>/</span><span>+${r.v2}${r.isC2?'<b class="c-badge">CAPOT</b>':''}</span>`;
            hUI.appendChild(li);
        });

        document.getElementById('undoBtn').disabled = log.length === 0;
    }

    function reset() {
        if(confirm("Nouvelle partie ?")) {
            g1 = 0; g2 = 0; log = [];
            update();
            in1.focus();
        }
    }

    window.onload = () => in1.focus();
</script>
</body>
</html>
