<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Belote</title>
    <style>
        :root {
            --nous-color: #0984e3;
            --eux-color: #d63031;
            --nous-grad: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
            --eux-grad: linear-gradient(135deg, #ff6b6b 0%, #ee0979 100%);
            --error-color: #ff4757;
            --success-color: #00b894;
            --bg-light: #fdfbfb;
            --text-main: #2d3436;
        }

        html, body { 
            overscroll-behavior-y: contain; margin: 0; padding: 0; 
            background: #f0f2f5; scroll-behavior: smooth; touch-action: manipulation; 
        }
        * { box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { padding: 10px; display: flex; justify-content: center; min-height: 100vh; }

        .app-container {
            width: 100%; max-width: 450px; background: white; border-radius: 30px;
            overflow: hidden; box-shadow: 0 15px 35px rgba(0,0,0,0.1); border: 6px solid white;
        }

        header { padding: 30px 20px; background: var(--bg-light); border-bottom: 2px solid #f1f2f6; }
        .scores-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        .team-title { 
            font-size: 0.85rem; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; 
            margin-bottom: 8px; color: #b2bec3; text-align: center; border-bottom: 1px dashed #dfe6e9; outline: none;
        }

        .score-val { 
            font-size: 4rem; 
            font-weight: 900; 
            line-height: 0.9; 
            margin-bottom: 15px; 
            text-align: center;
            font-variant-numeric: tabular-nums;
            text-shadow: 0 4px 10px rgba(0,0,0,0.05);
            letter-spacing: -2px;
        }
        #t1 { color: var(--nous-color); }
        #t2 { color: var(--eux-color); }

        .progress-box { height: 14px; background: #dfe6e9; border-radius: 50px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); }
        .progress-fill { height: 100%; width: 0%; border-radius: 50px; transition: width 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        #fill1 { background: var(--nous-grad); }
        #fill2 { background: var(--eux-grad); }
        .remaining { font-size: 0.75rem; margin-top: 10px; font-weight: 800; color: #a4b0be; text-align: center; letter-spacing: 0.5px;}

        #victory-banner {
            display: none; background: #e6fffb; border-bottom: 2px solid #b7eb8f;
            padding: 25px; text-align: center; animation: slideDown 0.4s ease-out;
        }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .vic-txt { color: var(--success-color); font-weight: 900; font-size: 1.4rem; line-height: 1.2; margin-bottom: 15px; }
        #winner-name { text-transform: uppercase; }

        .info-banner { background: #f9f9f9; padding: 12px; text-align: center; font-size: 0.95rem; font-weight: 700; color: #636e72; border-bottom: 1px solid #f1f2f6; }

        .controls { padding: 25px 20px; }
        .input-row { display: flex; gap: 20px; margin-bottom: 10px; }
        .input-box { flex: 1; position: relative; }
        .label-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; position: relative; }
        .label-row label { font-size: 0.65rem; font-weight: 800; color: #b2bec3; }
        .capot-btn { background: #f1f2f6; border: none; padding: 6px 10px; border-radius: 8px; color: #636e72; font-size: 0.65rem; font-weight: 800; cursor: pointer; }

        .belote-badge {
            position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%) scale(0);
            background: var(--success-color); color: white; padding: 2px 10px;
            border-radius: 20px; font-size: 0.7rem; font-weight: 900; white-space: nowrap;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 5;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .belote-badge.show { transform: translateX(-50%) scale(1); bottom: -12px; }

        .capot-mention {
            text-align: center; color: #f39c12; font-weight: 900; font-size: 0.7rem;
            text-transform: uppercase; margin-top: 15px; height: 15px; opacity: 0;
        }
        .capot-mention.show { opacity: 1; }

        input[type="number"] {
            width: 100%; padding: 15px; border: 3px solid #f1f2f6; border-radius: 20px;
            font-size: 1.2rem; transform: scale(1.05); text-align: center; font-weight: 900; color: var(--text-main);
            transition: all 0.2s; -webkit-appearance: none; background: #fff;
        }
        input[type="number"]:focus { border-color: #74b9ff; outline: none; transform: scale(1.1); box-shadow: 0 10px 20px rgba(116, 185, 255, 0.1); }
        
        .input-error-state { border-color: var(--error-color) !important; color: var(--error-color) !important; }
        .shake-anim { animation: shake 0.4s ease-in-out; }

        @keyframes shake { 
            0%, 100% { transform: scale(1.05) translateX(0); } 
            20% { transform: scale(1.05) translateX(-8px); } 
            40% { transform: scale(1.05) translateX(8px); } 
            60% { transform: scale(1.05) translateX(-8px); } 
            80% { transform: scale(1.05) translateX(8px); } 
        }

        .belote-row { display: flex; justify-content: space-around; margin: 15px 0 25px; }
        .belote-opt { display: flex; align-items: center; gap: 10px; font-weight: 800; color: #636e72; cursor: pointer; }
        input[type="checkbox"] { width: 28px; height: 28px; accent-color: var(--success-color); cursor: pointer; }

        .btn-group { display: flex; gap: 12px; padding: 0 20px 20px; }
        .btn-main { background: var(--success-color); color: white; flex: 3; padding: 20px; font-size: 1.1rem; font-weight: 900; text-transform: uppercase; border-radius: 18px; border:none; cursor:pointer; box-shadow: 0 8px 15px rgba(0, 184, 148, 0.2); }
        .btn-undo { background: #ffeaa7; color: #d6a000; flex: 1; font-size: 1.5rem; border-radius: 18px; border:none; cursor:pointer; }
        .btn-reset { background: none; color: #b2bec3; width: 100%; padding: 15px; font-size: 0.75rem; font-weight: 700; border:none; cursor:pointer;}
        
        /* ALIGNEMENT CENTR√â DANS CHAQUE COLONNE */
        .history-list { list-style: none; max-height: 200px; overflow-y: auto; background: #fafbfc; border-top: 1px solid #f1f2f6; padding: 0; }
        .history-item { 
            display: grid; 
            grid-template-columns: 1fr auto 1fr; 
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid #f1f2f6; 
            font-size: 1.15rem; 
            font-weight: 700; 
            font-variant-numeric: tabular-nums;
        }
        .history-item .val-left { text-align: center; color: var(--nous-color); }
        .history-item .divider { color: #dfe6e9; font-weight: 300; opacity: 0.6; }
        .history-item .val-right { text-align: center; color: var(--eux-color); }
        
        /* TAG CAPOT AJUST√â POUR NE PAS D√âCENTRER LE CHIFFRE */
        .cap-tag { 
            display: block; 
            font-size: 0.55rem; 
            color: #f39c12; 
            text-transform: uppercase; 
            letter-spacing: 1px;
            margin-top: -2px;
        }
    </style>
</head>
<body>

<div class="app-container">
    <header>
        <div class="scores-grid">
            <div class="team-card">
                <div class="team-title" id="name1" contenteditable="true">NOUS</div>
                <div class="score-val" id="t1">0</div>
                <div class="progress-box"><div id="fill1" class="progress-fill"></div></div>
                <div class="remaining" id="rem1">1000 restants</div>
            </div>
            <div class="team-card">
                <div class="team-title" id="name2" contenteditable="true">EUX</div>
                <div class="score-val" id="t2">0</div>
                <div class="progress-box"><div id="fill2" class="progress-fill"></div></div>
                <div class="remaining" id="rem2">1000 restants</div>
            </div>
        </div>
    </header>

    <div id="victory-banner">
        <div class="vic-txt">üèÜ Partie gagn√©e par <span id="winner-name">NOM</span> ! üèÜ</div>
        <button class="btn-main" onclick="reset()">D√©marrer une revanche</button>
    </div>

    <div class="info-banner" id="diff-text">Pr√™t pour la donne ?</div>

    <div id="input-zone">
        <div class="controls">
            <div class="input-row">
                <div class="input-box">
                    <div class="label-row">
                        <label>NOUS</label>
                        <button class="capot-btn" onclick="setCapot(1)">CAPOT</button>
                        <div class="belote-badge" id="tag1">+20 Points</div>
                    </div>
                    <input type="number" id="s1" placeholder="0" inputmode="numeric">
                    <div class="capot-mention" id="cm1">CAPOT !</div>
                </div>
                <div class="input-box">
                    <div class="label-row">
                        <label>EUX</label>
                        <button class="capot-btn" onclick="setCapot(2)">CAPOT</button>
                        <div class="belote-badge" id="tag2">+20 Points</div>
                    </div>
                    <input type="number" id="s2" placeholder="0" inputmode="numeric">
                    <div class="capot-mention" id="cm2">CAPOT !</div>
                </div>
            </div>
            <div class="belote-row">
                <label class="belote-opt"><input type="checkbox" id="b1" onclick="toggleBelote(1)"> Belote</label>
                <label class="belote-opt"><input type="checkbox" id="b2" onclick="toggleBelote(2)"> Belote</label>
            </div>
        </div>

        <div class="btn-group">
            <button class="btn-undo" onclick="undo()" id="undoBtn" disabled>‚Ü©</button>
            <button class="btn-main" onclick="addRound()">Valider la donne</button>
        </div>
    </div>

    <button class="btn-reset" onclick="reset()">REPRENDRE √Ä Z√âRO</button>
    <ul class="history-list" id="history"></ul>
</div>

<script>
    let g1 = 0, g2 = 0, log = [];
    const GOAL = 1000, MAX = 162, CAPOT = 252;
    const in1 = document.getElementById('s1'), in2 = document.getElementById('s2');
    const chk1 = document.getElementById('b1'), chk2 = document.getElementById('b2');
    const name1 = document.getElementById('name1'), name2 = document.getElementById('name2');

    [in1, in2].forEach(input => {
        input.addEventListener('focus', function() {
            if (this.value === "0") this.value = "";
            setTimeout(() => this.select(), 10);
        });
        input.addEventListener('blur', function() {
            if (this.value === "") this.placeholder = "0";
        });
    });

    window.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            if (document.getElementById('input-zone').style.display !== 'none') addRound();
        }
    });

    function handleShake(el) {
        el.classList.add('shake-anim');
        setTimeout(() => el.classList.remove('shake-anim'), 400);
    }

    function toggleBelote(team) {
        if (team === 1 && chk1.checked) chk2.checked = false;
        if (team === 2 && chk2.checked) chk1.checked = false;
        updateMentions();
    }

    function updateMentions() {
        let v1 = parseInt(in1.value), v2 = parseInt(in2.value);
        const isErr1 = v1 > MAX && v1 !== CAPOT;
        const isErr2 = v2 > MAX && v2 !== CAPOT;

        if (isErr1 && !in1.classList.contains('input-error-state')) handleShake(in1);
        if (isErr2 && !in2.classList.contains('input-error-state')) handleShake(in2);

        in1.classList.toggle('input-error-state', isErr1);
        in2.classList.toggle('input-error-state', isErr2);

        document.getElementById('tag1').classList.toggle('show', chk1.checked);
        document.getElementById('tag2').classList.toggle('show', chk2.checked);
        document.getElementById('cm1').classList.toggle('show', v1 === CAPOT);
        document.getElementById('cm2').classList.toggle('show', v2 === CAPOT);
    }

    in1.addEventListener('input', () => { 
        let v = parseInt(in1.value);
        if(!isNaN(v) && (v <= MAX || v === CAPOT)) in2.value = (v === CAPOT) ? 0 : MAX - v;
        updateMentions();
    });
    
    in2.addEventListener('input', () => { 
        let v = parseInt(in2.value);
        if(!isNaN(v) && (v <= MAX || v === CAPOT)) in1.value = (v === CAPOT) ? 0 : MAX - v;
        updateMentions();
    });

    function addRound() {
        let v1 = parseInt(in1.value) || 0, v2 = parseInt(in2.value) || 0;
        if (![v1, v2].includes(CAPOT) && (v1 + v2 !== MAX)) { 
            handleShake(v1 > v2 ? in1 : in2); 
            return; 
        }
        
        let b1 = chk1.checked ? 20 : 0, b2 = chk2.checked ? 20 : 0;
        log.push({v1: v1 + b1, v2: v2 + b2, isCapot: v1 === CAPOT || v2 === CAPOT});
        g1 += (v1 + b1); g2 += (v2 + b2);
        
        updateUI();
        in1.value = ""; in2.value = ""; chk1.checked = false; chk2.checked = false;
        in1.classList.remove('input-error-state'); in2.classList.remove('input-error-state');
        updateMentions();
        saveToLocal();
        window.scrollTo({ top: 0, behavior: 'smooth' });
        checkWin();
    }

    function updateUI() {
        document.getElementById('t1').textContent = g1;
        document.getElementById('t2').textContent = g2;
        document.getElementById('fill1').style.width = Math.min(100, (g1/GOAL)*100) + "%";
        document.getElementById('fill2').style.width = Math.min(100, (g2/GOAL)*100) + "%";
        document.getElementById('rem1').textContent = Math.max(0, GOAL - g1) + " restants";
        document.getElementById('rem2').textContent = Math.max(0, GOAL - g2) + " restants";
        const diff = Math.abs(g1 - g2);
        document.getElementById('diff-text').innerHTML = (g1 === 0 && g2 === 0) ? "Pr√™t ?" : `√âcart : <b>${diff} pts</b>`;
        
        const hUI = document.getElementById('history');
        hUI.innerHTML = '';
        [...log].reverse().forEach(r => {
            const li = document.createElement('li'); li.className = 'history-item';
            const cpLeft = (r.isCapot && r.v1 > r.v2) ? "<span class='cap-tag'>Capot</span>" : "";
            const cpRight = (r.isCapot && r.v2 > r.v1) ? "<span class='cap-tag'>Capot</span>" : "";
            li.innerHTML = `
                <div class="val-left">+${r.v1}${cpLeft}</div>
                <div class="divider">|</div>
                <div class="val-right">+${r.v2}${cpRight}</div>
            `;
            hUI.appendChild(li);
        });
        document.getElementById('undoBtn').disabled = log.length === 0;
    }

    function checkWin() {
        if (g1 >= GOAL || g2 >= GOAL) {
            document.getElementById('winner-name').textContent = g1 >= GOAL ? name1.textContent : name2.textContent;
            document.getElementById('victory-banner').style.display = 'block';
            document.getElementById('input-zone').style.display = 'none';
        }
    }

    function undo() { 
        if (log.length) { 
            if(confirm("Annuler la derni√®re donne enregistr√©e ?")) {
                log.pop(); 
                g1 = log.reduce((a, b) => a + b.v1, 0); 
                g2 = log.reduce((a, b) => a + b.v2, 0); 
                updateUI(); 
                saveToLocal(); 
            }
        } 
    }

    function reset() {
        if(confirm("Recommencer une nouvelle partie √† z√©ro ?")) {
            g1 = 0; g2 = 0; log = [];
            document.getElementById('victory-banner').style.display = 'none';
            document.getElementById('input-zone').style.display = 'block';
            updateUI(); saveToLocal();
        }
    }

    function saveToLocal() { localStorage.setItem('belote_save', JSON.stringify({ g1, g2, log, n1: name1.textContent, n2: name2.textContent })); }
    function setCapot(t) { if(t===1) { in1.value = 252; in2.value = 0; } else { in1.value = 0; in2.value = 252; } updateMentions(); }

    window.onload = () => {
        const saved = localStorage.getItem('belote_save');
        if (saved) {
            const d = JSON.parse(saved); g1 = d.g1; g2 = d.g2; log = d.log;
            name1.textContent = d.n1; name2.textContent = d.n2;
            updateUI(); checkWin();
        }
    };
</script>
</body>
</html>
